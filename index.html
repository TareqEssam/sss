<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø®Ø¨ÙŠØ± - Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…ØµØ±ÙŠØ©</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø°ÙƒØ§Ø¡ -->
<div class="intelligence-panel" id="intelligence-panel">
    <div class="intelligence-header">
        <span>ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ</span>
        <button onclick="toggleIntelligence()">ğŸ“Š</button>
    </div>
    <div class="intelligence-content" id="intelligence-content">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© ØªÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
<div class="prediction-bar" id="prediction-bar">
    <span>ğŸ¤” Ù‚Ø¯ ØªØ±ØºØ¨ ÙÙŠ:</span>
    <div class="predictions" id="predictions">
        <!-- ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
    </div>
</div>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>ğŸ¯ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø®Ø¨ÙŠØ±</h1>
                <p>Ù…Ø³Ø§Ø¹Ø¯ Ù„Ø¬Ø§Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© - Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</p>
            </div>
            <div class="status">
                <span id="status-indicator" class="status-loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                <span id="db-size" class="db-info"></span>
            </div>
        </header>

        <!-- Chat Area -->
        <div class="chat-container" id="chat-container">
            <div class="welcome-message">
                <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø®Ø¨ÙŠØ±</h2>
                <p>ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:</p>
                <ul>
                    <li>âœ… Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ© Ù„ÙƒÙ„ Ù†Ø´Ø§Ø·</li>
                    <li>ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©</li>
                    <li>ğŸ­ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© ÙˆÙ‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</li>
                    <li>ğŸ’° Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù‚Ø±Ø§Ø± 104 ÙˆØ§Ù„Ø­ÙˆØ§ÙØ²</li>
                    <li>ğŸ” Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙÙ†ÙŠØ© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</li>
                </ul>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-container">
            <div class="quick-questions" id="quick-questions">
                <button class="quick-btn" onclick="askQuestion('Ù…Ø§ Ù‡ÙŠ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØŸ')">
                    ğŸ­ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ
                </button>
                <button class="quick-btn" onclick="askQuestion('Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø¨Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŸ')">
                    ğŸ“ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©
                </button>
                <button class="quick-btn" onclick="askQuestion('Ù‡Ù„ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø± 104ØŸ')">
                    ğŸ’° Ø§Ù„Ù‚Ø±Ø§Ø± 104
                </button>
            </div>
            <div class="input-wrapper">
                <textarea 
                    id="query-input" 
                    placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Shift+Enter Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯)"
                    rows="1"
                    disabled
                ></textarea>
                <button id="send-btn" onclick="sendQuery()" disabled>
                    <span>Ø¥Ø±Ø³Ø§Ù„</span>
                    <span class="icon">ğŸ“¤</span>
                </button>
            </div>
            <div class="memory-indicator" id="memory-indicator"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="loader.js"></script>
    <script src="intent-engine.js"></script>
    <script src="core-v2.js"></script>
    <script>
        let conversationHistory = [];

        // Initialize on load
        window.addEventListener('load', async () => {
            await initializeSystem();
        });

        async function initializeSystem() {
            const statusEl = document.getElementById('status-indicator');
            const inputEl = document.getElementById('query-input');
            const sendBtn = document.getElementById('send-btn');

            try {
                statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
                statusEl.className = 'status-loading';

                // Load data
                const startTime = Date.now();
                await DataLoader.initialize();
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);

                // Initialize embedding model
                statusEl.textContent = 'âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²...';

                // Update UI
                statusEl.textContent = 'âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…';
                statusEl.className = 'status-ready';
                
                const dbSize = document.getElementById('db-size');
                dbSize.textContent = `ğŸ“Š ${DataLoader.getTotalVectors()} Ù…ØªØ¬Ù‡ | âš¡ ${loadTime}Ø«`;

                inputEl.disabled = false;
                sendBtn.disabled = false;
                inputEl.focus();

            } catch (error) {
                statusEl.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                statusEl.className = 'status-error';
                console.error('Initialization error:', error);
                addMessage('system', `Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`);
            }
        }

        async function sendQuery() {
            const input = document.getElementById('query-input');
            const query = input.value.trim();
            
            if (!query) return;

            // Add user message
            addMessage('user', query);
            input.value = '';
            input.style.height = 'auto';

            // Show thinking indicator
            const thinkingId = addMessage('assistant', 'ğŸ¤” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...', true);

            try {
                // Process query
                const result = await ExpertAssistant.answer(query, conversationHistory);
                
                // Remove thinking indicator
                document.getElementById(thinkingId)?.remove();

                // Add assistant response
                addMessage('assistant', result.answer, false, result);

                // Update conversation history
                conversationHistory.push({
                    question: query,
                    answer: result.answer,
                    intent: result.intent,
                    entities: result.entities,
                    timestamp: Date.now()
                });

                // Keep only last 5 exchanges
                if (conversationHistory.length > 5) {
                    conversationHistory = conversationHistory.slice(-5);
                }

                updateMemoryIndicator();

            } catch (error) {
                document.getElementById(thinkingId)?.remove();
                addMessage('system', `Ø®Ø·Ø£: ${error.message}`);
            }
        }

        function addMessage(type, content, isTemp = false, data = null) {
            const chatContainer = document.getElementById('chat-container');
            const messageId = `msg-${Date.now()}-${Math.random()}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.id = messageId;

            if (type === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">${escapeHtml(content)}</div>
                `;
            } else if (type === 'assistant') {
                let sourcesHtml = '';
                if (data && data.sources && data.sources.length > 0) {
                    sourcesHtml = '<div class="sources">';
                    sourcesHtml += '<div class="sources-header">ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø±:</div>';
                    data.sources.forEach((src, idx) => {
                        const confidence = (src.score * 100).toFixed(0);
                        const confidenceClass = confidence > 80 ? 'high' : confidence > 60 ? 'medium' : 'low';
                        sourcesHtml += `
                            <div class="source-item">
                                <span class="source-label">${idx + 1}.</span>
                                <span class="source-text">${escapeHtml(src.text)}</span>
                                <span class="confidence ${confidenceClass}">${confidence}%</span>
                            </div>
                        `;
                    });
                    sourcesHtml += '</div>';
                }

                messageDiv.innerHTML = `
                    <div class="message-content">${formatAnswer(content)}</div>
                    ${sourcesHtml}
                `;
            } else {
                messageDiv.className = 'message system-message';
                messageDiv.innerHTML = `<div class="message-content">${escapeHtml(content)}</div>`;
            }

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            return messageId;
        }

        function formatAnswer(text) {
            // Format the answer with better readability
            text = escapeHtml(text);
            
            // Bold headers
            text = text.replace(/^(#+)\s*(.+)$/gm, '<strong>$2</strong>');
            
            // Line breaks
            text = text.replace(/\n/g, '<br>');
            
            // Bullet points
            text = text.replace(/^-\s+(.+)$/gm, 'â€¢ $1');
            
            return text;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function askQuestion(question) {
            document.getElementById('query-input').value = question;
            sendQuery();
        }

        function updateMemoryIndicator() {
            const indicator = document.getElementById('memory-indicator');
            const count = conversationHistory.length;
            
            if (count > 0) {
                indicator.innerHTML = `ğŸ’­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${count}/5 Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³Ø§Ø¨Ù‚Ø©`;
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        // Auto-resize textarea
        document.getElementById('query-input')?.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });

        // Enter to send, Shift+Enter for new line
        document.getElementById('query-input')?.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendQuery();
            }
        });
        // ================ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ================

        // Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡
        function displayIntelligenceAnalysis(result) {
            const panel = document.getElementById('intelligence-content');
            if (!panel) return;

            let html = `
                <div class="intelligence-item">
                    <strong>Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</strong> ${result.intent.name}
                    <br><small>Ø«Ù‚Ø©: ${(result.intent.confidence * 100).toFixed(0)}%</small>
                </div>
            `;

            if (result.entities && result.entities.activities && result.entities.activities.length > 0) {
                html += `
                    <div class="intelligence-item">
                        <strong>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</strong>
                        ${result.entities.activities.map(a => a.name).join(', ')}
                    </div>
                `;
            }

            if (result.explanation) {
                html += `
                    <div class="intelligence-item">
                        <strong>ÙƒÙŠÙ ÙÙ‡Ù…Øª Ø§Ù„Ø³Ø¤Ø§Ù„:</strong>
                        <br>${result.explanation}
                    </div>
                `;
            }

            panel.innerHTML = html;
            document.getElementById('intelligence-panel').style.display = 'block';
        }

        // Ø¹Ø±Ø¶ ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function displayPredictions(predictions) {
            const container = document.getElementById('predictions');
            if (!container) return;

            if (!predictions || predictions.length === 0) {
                container.innerHTML = '<span style="color: #666">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙ‚Ø¹Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</span>';
                return;
            }

            let html = '';
            predictions.forEach((pred, idx) => {
                html += `
                    <button class="prediction-btn" onclick="askPrediction('${pred.replace(/'/g, "\\'")}')">
                        ${pred}
                    </button>
                `;
            });

            container.innerHTML = html;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„ ØªÙˆÙ‚Ø¹
        function askPrediction(question) {
            document.getElementById('query-input').value = question;
            sendQuery();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡
        function toggleIntelligence() {
            const content = document.getElementById('intelligence-content');
            if (content.style.display === 'none') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© sendQuery Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡
        async function sendQuery() {
            const input = document.getElementById('query-input');
            const query = input.value.trim();
            
            if (!query) return;

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage('user', query);
            input.value = '';
            input.style.height = 'auto';

            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙÙƒÙŠØ±
            const thinkingId = addMessage('assistant', 'ğŸ§  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ...', true);

            try {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø­Ø³Ù†
                const result = await ExpertAssistant.answer(query, conversationHistory);
                
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙÙƒÙŠØ±
                document.getElementById(thinkingId)?.remove();

                // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡
                const messageId = addMessage('assistant', result.answer, false, result);
                
                // Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (result.explanation) {
                    const explanationDiv = document.createElement('div');
                    explanationDiv.className = 'explanation';
                    explanationDiv.innerHTML = `ğŸ’¡ ${result.explanation}`;
                    document.getElementById(messageId)?.appendChild(explanationDiv);
                }

                // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                conversationHistory.push({
                    question: query,
                    answer: result.answer,
                    intent: result.intent,
                    entities: result.entities,
                    timestamp: Date.now()
                });

                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 5 ØªØ¨Ø§Ø¯Ù„Ø§Øª ÙÙ‚Ø·
                if (conversationHistory.length > 5) {
                    conversationHistory = conversationHistory.slice(-5);
                }

                updateMemoryIndicator();

                // Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡
                if (result.predictions) {
                    displayPredictions(result.predictions);
                }

                if (result.intent && result.intent.name !== 'ERROR') {
                    displayIntelligenceAnalysis(result);
                }

                // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                document.getElementById('intelligence-panel').style.display = 'block';

            } catch (error) {
                document.getElementById(thinkingId)?.remove();
                addMessage('system', `âš ï¸ Ø®Ø·Ø£ Ø°ÙƒÙŠ: ${error.message}`);
            }
        }

        // ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ù„Ø© addMessage Ù„Ø¯Ø¹Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø°ÙƒÙŠØ©
        function addMessage(type, content, isTemp = false, data = null) {
            const chatContainer = document.getElementById('chat-container');
            const messageId = `msg-${Date.now()}-${Math.random()}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message ${data?.intent?.name?.startsWith('ACTIVITY') ? 'smart-message' : ''}`;
            messageDiv.id = messageId;

            if (type === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">${escapeHtml(content)}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
            } else if (type === 'assistant') {
                let sourcesHtml = '';
                if (data && data.sources && data.sources.length > 0) {
                    sourcesHtml = '<div class="sources">';
                    sourcesHtml += '<div class="sources-header">ğŸ§­ Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©:</div>';
                    data.sources.forEach((src, idx) => {
                        const confidence = (src.relevance * 100).toFixed(0);
                        const confidenceClass = confidence > 80 ? 'high' : confidence > 60 ? 'medium' : 'low';
                        const sourceIcon = src.dataType === 'activities' ? 'ğŸ“‹' : 
                                         src.dataType === 'industrial' ? 'ğŸ­' : 'ğŸ’°';
                        
                        sourcesHtml += `
                            <div class="source-item">
                                <span class="source-label">${sourceIcon} ${idx + 1}.</span>
                                <span class="source-text">${escapeHtml(src.text)}</span>
                                <span class="source-type">${src.dataType}</span>
                                <span class="confidence ${confidenceClass}">${confidence}%</span>
                            </div>
                        `;
                    });
                    sourcesHtml += '</div>';
                }

                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span class="assistant-avatar">ğŸ¤–</span>
                        <span class="intent-badge" style="background: ${getIntentColor(data?.intent?.name)}">
                            ${getIntentLabel(data?.intent?.name)}
                        </span>
                    </div>
                    <div class="message-content">${formatAnswer(content)}</div>
                    ${sourcesHtml}
                    <div class="message-time">${new Date().toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
            } else {
                messageDiv.className = 'message system-message';
                messageDiv.innerHTML = `
                    <div class="message-content">${escapeHtml(content)}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
            }

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            return messageId;
        }

        // Ø¯Ø§Ù„Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡
        function getIntentColor(intentName) {
            const colors = {
                'ACTIVITY_LICENSE': '#51cf66',
                'ACTIVITY_AUTHORITY': '#339af0',
                'ACTIVITY_LAW': '#ff6b6b',
                'INDUSTRIAL_ZONE_SEARCH': '#ff922b',
                'DECISION104_CHECK': '#cc5de8',
                'GENERAL': '#adb5bd'
            };
            return colors[intentName] || '#adb5bd';
        }

        function getIntentLabel(intentName) {
            const labels = {
                'ACTIVITY_LICENSE': 'ØªØ±Ø§Ø®ÙŠØµ',
                'ACTIVITY_AUTHORITY': 'Ø¬Ù‡Ø§Øª',
                'ACTIVITY_LAW': 'Ù‚ÙˆØ§Ù†ÙŠÙ†',
                'INDUSTRIAL_ZONE_SEARCH': 'Ù…Ù†Ø§Ø·Ù‚ ØµÙ†Ø§Ø¹ÙŠØ©',
                'DECISION104_CHECK': 'Ù‚Ø±Ø§Ø± 104',
                'GENERAL': 'Ø¹Ø§Ù…'
            };
            return labels[intentName] || 'Ø¹Ø§Ù…';
        }

        // ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ù„Ø© formatAnswer Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
        function formatAnswer(text) {
            text = escapeHtml(text);
            
            // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
            text = text.replace(/^\*\*(.+?)\*\*\n/gm, '<strong class="answer-title">$1</strong><br>');
            text = text.replace(/\n\n/g, '</div><div class="answer-section">');
            text = text.replace(/\n/g, '<br>');
            text = text.replace(/â€¢/g, 'â€¢ ');
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            return `<div class="answer-content"><div class="answer-section">${text}</div></div>`;
        }

        // ØªØ­Ø³ÙŠÙ† escapeHtml
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/"/g, '&quot;').replace(/'/g, '&#039;');
        }
        
    </script>
</body>
</html>


